<!DOCTYPE html>
<html>
<head>
	<title>Mapnik Bench</title>
	<link href='https://www.mapbox.com/base/latest/base.css' rel='stylesheet' />
	<script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
	<style>

	body {
		font-family: sans-serif;
		color: #f8f8f8;
	}
	table {
		border-collapse: collapse;
		background: #eee;
		color: #222b30;
	}
	table td,
	table th {
		border: 1px solid #222b30;
		padding: 10px;
		min-width: 100px;
	}
	th {
		background: #222b30;
		color: #eee;
	}
	.container {
		width: 80%;
		margin: 2em auto;
	}
	.geom,
	.ver,
	.env {
		font-family: monospace;
	}
	.ver {}
	.high {
		background: #2ECC40;
	}
	.low {
		background: #FF4136;
	}
	</style>
</head>
<body class="fill-navy">
	
	<div class="container col12 clearfix">
		<h1>Tuesday, Feb 2 at 12:27pm</h1>
		<div class="col12">
			<div class="col2 pad1y"><strong>Platform</strong><br><span class="env" id="platform"></span></div>
			<div class="col2 pad1y"><strong>Release</strong><br><span class="env" id="release"></span></div>
			<div class="col2 pad1y"><strong>Type</strong><br><span class="env" id="ostype"></span></div>
		</div>
		<div id="data"></div>
	</div>	

<script>
var geometries = [];
var versions = [];
var bench;
var env = false;
// yay DOM strings :(

$(document).ready(function(){

	var file = window.location.search.replace('?', '');
	console.log(file);

	$.getJSON( 'https://s3.amazonaws.com/mapbox/playground/mapsam/'+file+'.json', function( data ) {
		console.log(data);
		bench = data;

		// for each version
		for (var v in data.versions) {
			var VERSION = data.versions[v];

			// gather versions if we haven't pushed yet
			if (versions.indexOf(v) == -1) versions.push(v);

			// for each test in the version
			for (var g in VERSION) {
				var GEOM = VERSION[g];

				// if no env set, set that
				// tood, put ENV information at the root of benchmark object
				if (!env) {
					$('#platform').text(GEOM.os.platform);
					$('#release').text(GEOM.os.release);
					$('#ostype').text(GEOM.os.type);
					env = true;
				}

				// gather geometries if they haven't been added yet
				if (geometries.indexOf(g) == -1) geometries.push(g); 


			}
		}

		makeTheTable(geometries, versions);
	});
});

function makeTheTable(g, v) {

	// create headers
	var header = '<tr><th>Input file</th>';
	var table = '<table>';
	$.each(versions, function(v) {
		header+='<th class="ver">'+versions[v]+'</th>';
	});
	header += '</tr>';
	var rows = '';

	// go through each geometry and get the version information for that geom
	$.each(geometries, function(g) {
		var row = '<tr><td class="geom">'+geometries[g]+'</td>';
		$.each(versions, function(v) {
			var B = bench.versions[versions[v]][geometries[g]].result;
			var time = Math.round(B.time * 1000) / 1000;
			var tps = Math.round(B.tiles_per_second * 1000) / 1000;
			var tpst = Math.round(B.tiles_per_second_per_thread * 1000) / 1000;
			row += '<td><strong>'+time+'</strong> seconds<br><small><strong>'+B.tiles_rendered+'</strong> total tiles rendered<br><strong>'+tps+'</strong> TPS<br><strong>'+tpst+'</strong> TPS per thread</small></td>';
		});
		row += '</tr>';
		rows += row;
	});

	table += header + rows + '</table>';
	document.getElementById('data').innerHTML = table;
}

function minmax(array) {

}
</script>
</body>
</html>